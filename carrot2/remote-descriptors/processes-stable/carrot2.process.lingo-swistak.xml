<?xml version="1.0" encoding="UTF-8"?>

<process
    xmlns="http://www.dawidweiss.com/projects/carrot/processDescriptor"
    id="carrot2.process.swistak"
    description="Auctions from Swistak.pl"
>
    <processing-script language="beanshell"><![CDATA[

    controller.setUseCachedInput(true);
    controller.setDoCacheInput(true);

    InputStream is;

    Map inputOptions = new HashMap();

    // This is quite tricky -- the aggregation of RSSs is done IN THE STYLESHEET (see
    // it in the component's named-xslt folder).
    inputOptions.put("xslt", "/named-xslt/swistak.xsl");
    inputOptions.put("source", "/named-xslt/swistak-feed.xml");
    
    // Put stylesheet arguments in parameters.
    inputOptions.put("swistak.query", java.net.URLEncoder.encode(query.getQuery(), "iso8859-2"));
    int resultsRequested = query.getNumberOfExpectedResults();
    inputOptions.put("swistak.results", Integer.toString(resultsRequested));

    is = controller.invokeInputComponent( "carrot2.input.xml", query, inputOptions );

    Map lingoOptions = new HashMap();
    lingoOptions.put("language.english", "com.dawidweiss.carrot.util.tokenizer.languages.english.English");
    lingoOptions.put("lsi.threshold.clusterAssignment", "0.150");
    lingoOptions.put("lsi.threshold.candidateCluster",  "0.775");
    is = controller.invokeFilterComponent( "carrot2.filter.multilingual-lingo-clustering", is, lingoOptions );

    Map dtreeOptions = new HashMap();
    dtreeOptions.put("dtree.css", "compact");
    dtreeOptions.put("param.output.terminal.nodes", "true" );
    dtreeOptions.put("param.max.open.level", "0");
    dtreeOptions.put("param.max.subgroup.snippets.included", "3" );
    dtreeOptions.put("param.no.terminal.groups.expansion", "true" );
    dtreeOptions.put("param.snippets.sorting.type", "ORDER_DOCUMENTS_ORDER");

    is = controller.invokeOutputComponent( "carrot2.output.xslt-renderer.dynamic-tree", is, dtreeOptions );
    
    controller.sendResponse( is );     
    ]]>
    </processing-script>
</process>

