<?xml version="1.0" encoding="UTF-8" ?>

<project name="Nutch Input Component Adapter for Carrot2" default="help" basedir="." >

  <!-- ## these are overrioden by master build file ### -->

  <property name="distribution.dir" location="tmp/dist" />
  <property name="javadoc.dir"      location="tmp/javadoc" />
  <property name="carrot2.cvs.dir"  location="../../.." />

  <!-- ## global properties ### -->

  <property name="build.dir"        location="tmp/build" />
  <property name="build.compiler"   value="modern" /> 
  <property name="dist.name"        value="carrot2-adapter-nutch" />

  <!-- ## local properties ### -->

  <property name="src.path"            location="src" />
  <property name="javac.optimize"      value="off" />
  <property name="javac.debug"         value="on" />

  <!-- ## classpath for compiling classes ## -->

  <path id="carrot.shared.libs">
    <!-- all jars runtime/shared/lib -->
    <fileset dir="${carrot2.cvs.dir}/lib">  
      <include name="**/*.jar"/>
    </fileset>
  </path>

  <!-- ## project classpath ### -->
  <path id="compile.classpath">
    <path refid="carrot.shared.libs" />
  </path>

  <!-- ##################################### -->
  <!-- ### {{{ CLEAN                     ### -->
  <!-- ##################################### -->
  <target name="clean" description="Removes compiled classes and distribution files.">
    <delete failonerror="false" includeemptydirs="true" quiet="true">
        <fileset dir="tmp" />
    </delete>
  </target>
  <!-- }}} -->

  
  <!-- ##################################### -->
  <!-- ### {{{ PREPARE                   ### -->
  <!-- ##################################### -->

  <target name="check-nutch-available">
    <condition property="cond:nutch.available" value="true">
        <and>
            <available file="lib" type="dir" />
            <available classname="net.nutch.searcher.NutchBean">
                <classpath>
                    <fileset dir="lib" includes="**/*.jar" />
                </classpath>
            </available>
        </and>
    </condition>
  </target>
  
  <target name="prepare" depends="check-nutch-available" if="cond:nutch.available">
    <mkdir dir="${distribution.dir}"  />
    <mkdir dir="${build.dir}"  />
  </target>
  <!-- }}} -->


  <!-- ##################################### -->
  <!-- ### {{{ COMPILE SOURCE FILES      ### -->
  <!-- ##################################### -->

  <target name="compile" depends="prepare,nutch-info" if="cond:nutch.available">
    <javac destdir     = "${build.dir}"
           debug       = "${java.debug}"
           optimize    = "${java.optimize}"
           deprecation = "on"
           includeantruntime = "false"
           includejavaruntime = "false"
    >
        <!-- add source code paths. -->
        <src path="${src.path}" />
        <exclude name="**/*Test.java"/>
        <classpath refid="compile.classpath" />
        <classpath>
            <fileset dir="lib" includes="**/*.jar" />
        </classpath>
    </javac>

    <!-- copy any non-java files (resources) from the source path. -->
    <copy toDir="${build.dir}">
       <fileset dir="${src.path}">
         <exclude name="**/*.java"/>
       </fileset>
    </copy>    
  </target>
  
  <target name="nutch-info" unless="cond:nutch.available">
    <echo>
WARNING: Nutch is not available. Put Nutch's JAR into the 'lib'
folder to compile this component.
    </echo>
  </target>
  <!-- }}} -->


  <!-- ##################################### -->
  <!-- ### {{{ build jar file            ### -->
  <!-- ##################################### -->
  <target name="build" depends="compile" if="cond:nutch.available">
    <tstamp />
	<jar update="false" jarfile="${distribution.dir}/${dist.name}.jar">
		<fileset dir="${build.dir}" />
        <manifest>
            <attribute name="Assembly-date" value="${DSTAMP} ${TSTAMP}"/>
        </manifest>		
	</jar>
  </target>
  <!-- }}} -->


  <!-- ##################################### -->
  <!-- ### {{{ HELP ON THIS FILE         ### -->
  <!-- ##################################### -->
  <target name="help" description="Displays help on available targets.">
    <echo>
    Project name: ${ant.project.name}

    Current JDK: ${ant.java.version}
    Basedir    : ${basedir}
    -----------------------------------------------------

    Available targets:

    clean     Removes all temporary files.
    compile   Compiles the project.
    build     Builds WAR file
    </echo>
  </target>
  <!-- }}} -->

</project>

