<project name="Carrot2 Grokker Plugin" default="build">

    <property file="${user.home}/.carrot.properties" />
	<property file="local.properties" />
    
	<property name="project.dir"      location="${basedir}" />
	<property name="carrot2.cvs.dir"  location="../.." />
        <property name="tests.available"  value="true" />


	<property name="type"       	  value="jartype" />
	<property name="dist.name"        value="carrot2-grokker-clusterizer" />

	<property name="distribution.dir" location="${project.dir}/tmp/dist" />
	<property name="component.descriptor" location="carrot2-grokker-clusterizer.dep.xml" />

    <import file="${carrot2.cvs.dir}/components/common-targets.inc" />

    <path id="classpath.local">
        <fileset dir="${grokker.sdk}" includes="lib/*.jar" />
    </path>
    
    <target name="build" depends="sdk.info,build.sdk.ok">
    </target>
    
    <target name="sdk.info" unless="grokker.sdk">
        <echo>
Grokker plugin cannot be built due to missing SDK.

Specify 'grokker.sdk' property pointing to your Grokker SDK
installation. You can put this property in a
'local.properties' file in this folder. For example:

# Local settings
grokker.sdk=g:/Repositories/groxis/Grokker-2.2-SDK
        </echo>
    </target>
    
	<target name="build.sdk.ok" if="grokker.sdk">
		<property name="copy.dependencies" value="true" />
        
		<ant target="build.${type}"
             antfile="${carrot2.cvs.dir}/components/master.xml" inheritall="true" inheritrefs="true">
		</ant>

        <!-- Now reassemble the JAR into Grokker plugin -->
        <zip zipfile="${distribution.dir}/${dist.name}.jar" duplicate="fail" update="true">
            <zipfileset file="etc/groxis-plugin.xml" fullpath="META-INF/groxis-plugin.xml" />
            <!-- This is clearly a mistake in Grokker, but we must respect it -->
            <zipfileset file="etc/groxis-plugin.xml" fullpath="meta-inf/groxis-plugin.xml" />
            <zipfileset prefix="lib" dir="${distribution.dir}/deps-${dist.name}-jar">
                <include name="*.*" />
            </zipfileset>
        </zip>
	</target>
    

</project>
