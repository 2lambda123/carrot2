apply plugin: 'java-library'

apply from: rootProject.file("gradle/jflex.gradle")

configurations {
  langResources
  jsondoclet
  jsonJavadocs
}

dependencies {
  api "org.slf4j:slf4j-api"
  api "com.carrotsearch:hppc"

  langResources fileTree(dir: 'src/main/resources', includes: ['**/*.stopwords.utf8', '**/*.stoplabels.utf8'])

  jsondoclet project(":infra:jsondoclet")
}

spotless {
  java {
    targetExclude "**/nanojson/*", "**/ExtendedWhitespaceTokenizerImpl.java*"
  }
}

ext {
  javadocJsonDir = file("${buildDir}/javadoc-json")
}

def javadocExcludes = [
  'org/carrot2/math/mahout/**',
  '**/nanojson/**',
  '**/ExtendedWhitespaceTokenizerImpl*'
]

javadoc {
  exclude javadocExcludes
}

task javadocJson(type: Javadoc, dependsOn: compileJava) {
  dependsOn compileJava
  dependsOn configurations.jsondoclet

  title = null

  options.encoding = 'UTF-8'
  source = sourceSets.main.allJava
  classpath = sourceSets.main.output + sourceSets.main.compileClasspath

  destinationDir = javadocJsonDir

  options.doclet = 'com.carrotsearch.jsondoclet.JsonDoclet'
  options.memberLevel = JavadocMemberLevel.PUBLIC

  exclude javadocExcludes

  doFirst {
    options.docletpath = configurations.jsondoclet.toList()
  }
}

artifacts {
  jsonJavadocs javadocJsonDir, {
    builtBy javadocJson
  }
}
