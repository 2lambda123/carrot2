
<project name="Carrot2 Website deploy script." default="help" basedir=".">

    <property name="checkout.dir" location="tmp/checkouts" />
    <property name="cvs.pass" location="${user.home}/.cvspass" />
    <property name="module.name" value="website" />
    <property name="cvs.root" value=":ext:dawidweiss@cvs.sourceforge.net:/cvsroot/carrot2" />

    <property name="build.dir" location="tmp/build.website" />

    <!-- 
      ## Prepare checkout directory and cvs environment.
      -->
    <target name="prepare">
        <mkdir dir="${checkout.dir}" />
        <mkdir dir="${build.dir}" />
    </target>
    
    <target name="cvsupdate" depends="prepare">
        <cvspass cvsroot="${cvs.root}" password="" passfile="${cvs.pass}"/>

        <ant antfile="cvsoperations.xml" target="cvs.checkout_or_update.module" inheritall="false">
            <property name="checkout.dir" location="${checkout.dir}" />
            <property name="cvs.pass"     location="${cvs.pass}" />
            <property name="module.name" value="${module.name}" />
            <property name="cvs.root" value="${cvs.root}" />
        </ant>
    </target>
    
    <target name="clean">
        <delete dir="${build.dir}" failonerror="false" includeemptydirs="true" quiet="true" />
    </target>
    
    <!-- 
      ## Checkout the website to local directory, build it
      ## and deploy to the Web server.
      -->
    <target name="build" depends="clean, prepare">        
        <ant antfile="${checkout.dir}/${module.name}/build.xml" 
             dir="${checkout.dir}/${module.name}" inheritall="false" 
             target="build.php">
            <property name="distribution.dir" location="${build.dir}" />
        </ant>

        <copy filtering="false" includeemptydirs="true" todir="${build.dir}"
              overwrite="true">
            <fileset dir="website-libra" includes="**/*" />
        </copy>
    </target>

    <target name="publish" depends="build">
        <property file="${user.home}/.pwds" />

        <ftp
            remotedir="carrot2.org/website"
            server="ftp.carrot2.org"
            skipfailedtransfers="false"
            userid="dweiss.carrot"
            password="${ftp.carrot2.org}"
            verbose="yes"
            newer="false"
            passive="true"
            ignoreNoncriticalErrors="true">
            <fileset dir="${build.dir}">
                <include name="**/*" />
            </fileset>
        </ftp>
    </target>

  <!-- ##################################### -->
  <!-- ### {{{ HELP ON THIS FILE         ### -->
  <!-- ##################################### -->
    <target name="help" description="Displays help on available targets.">
    <echo>
    This ANT script is used to deploy Carrot2 Web site.
    It is for internal use only and contains no public targets.
    </echo>
    </target>
  <!-- }}} -->

</project>

