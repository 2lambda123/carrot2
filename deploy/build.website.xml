
<project name="Carrot2 Website deploy script." default="help" basedir=".">

    <property name="checkout.dir" location="tmp" />
    <property name="cvs.pass" location="${user.home}/.cvspass" />
    <property name="module.name" value="website" />
    <property name="cvs.root" value=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/carrot2" />
    

    <!-- 
      ## Prepare checkout directory and cvs environment.
      -->
    <target name="prepare">
        <mkdir dir="${checkout.dir}" />
        <cvspass cvsroot="${cvs.root}" password="" passfile="${cvs.pass}"/>

        <ant antfile="cvsoperations.xml" target="cvs.checkout_or_update.module" inheritall="false">
            <property name="checkout.dir" location="${checkout.dir}" />
            <property name="cvs.pass"     location="${cvs.pass}" />
            <property name="module.name" value="${module.name}" />
            <property name="cvs.root" value="${cvs.root}" />
        </ant>
    </target>
    
    <!-- 
      ## Checkout the website to local directory, build it
      ## and deploy to the Web server.
      -->
    <target name="build" depends="prepare">
        <delete dir="${checkout.dir}/build" failonerror="false"
                includeemptydirs="true" quiet="true" />
        
        <ant antfile="${checkout.dir}/${module.name}/build.xml" 
             dir="${checkout.dir}/${module.name}" inheritall="false" 
             target="build.php">
            <property name="distribution.dir" location="${checkout.dir}/build" />
        </ant>

        <copy filtering="false" includeemptydirs="true" todir="${checkout.dir}/build"
              overwrite="true">
            <fileset dir="website-libra" includes="**/*" />
        </copy>
    </target>

    <target name="publish" depends="build">
        <property file="${user.home}/.pwds" />

        <ftp
            remotedir="public_html/carrot"
            server="libra.cs.put.poznan.pl"
            skipfailedtransfers="false"
            userid="dweiss"
            password="${www.cs.put.poznan.pl}"
            verbose="yes"
            ignoreNoncriticalErrors="true">
            <fileset dir="${checkout.dir}/build">
                <include name="**/*" />
            </fileset>
        </ftp>
    </target>

  <!-- ##################################### -->
  <!-- ### {{{ HELP ON THIS FILE         ### -->
  <!-- ##################################### -->
    <target name="help" description="Displays help on available targets.">
    <echo>
    This ANT script is used to deploy Carrot2 Web site.
    It is for internal use only and contains no public targets.
    </echo>
    </target>
  <!-- }}} -->

</project>

